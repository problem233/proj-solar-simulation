{"version":3,"sources":["canvas.ts","simulation.ts","index.ts"],"names":[],"mappings":"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","file":"src.f460abfa.js","sourceRoot":"../src","sourcesContent":["export function clearCanvas (ctx: CanvasRenderingContext2D) {\n  ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height)\n}\n\nexport function circle (x: number, y: number, r: number) {\n  const path = new Path2D()\n  path.moveTo(x + r, y)\n  path.arc(x, y, r, 0, Math.PI * 2)\n  return path\n}\n\nexport function fadeOut (ctx: CanvasRenderingContext2D, opacity = 99) {\n  // tslint:disable-next-line:prefer-const\n  let data = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height)\n  for (let y = 0; y < data.height; y++)\n    for (let x = 0; x < data.width; x++)\n      data.data[((x * (data.height * 4)) + (y * 4)) + 3] -= (100 - opacity)\n  ctx.putImageData(data, 0, 0)\n}\n\nexport function fadingOutTrace (\n    ctx: CanvasRenderingContext2D,\n    x: number, y: number, width = 3, opacity?: number) {\n  fadeOut(ctx, opacity)\n  ctx.fill(circle(x, y, width / 2))\n}\n\nexport type Style = Array<[number, string]>\n\nexport function styledCircle (\n    ctx: CanvasRenderingContext2D,\n    s: Style, x: number, y: number, r: number) {\n  const grad = ctx.createRadialGradient(x, y, 0, x, y, r)\n  s.forEach(([offset, color]) => grad.addColorStop(offset, color))\n  ctx.fillStyle = grad\n  ctx.fill(circle(x, y, r))\n}\n","type Vec = [number, number]\n\nexport interface State {\n  t: number\n  m: number\n  m_v: Vec\n  /**\n   * relative to M\n   */\n  m_pos: Vec\n  M: number\n}\n\nconst G = 6.674e-11\n\nconst square = (x: number) => x * x\n\nconst vecPlus = (x: Vec, y: Vec): Vec => [x[0] + y[0], x[1] + y[1]]\nexport const vecMult = (k: number, x: Vec) => <Vec> x.map(x => k * x)\nexport const vecSquare = ([x, y]: Vec) => x * x + y * y\nexport const vecLength = (x: Vec) => Math.sqrt(vecSquare(x))\n\nexport function simulate (\n    { t, m, m_v, m_pos: [m_x, m_y], M }: State, T: number): State {\n  const angle = Math.atan2(m_y, m_x) + Math.PI\n  const a = vecMult(G * M / (square(m_x) + square(m_y)),\n                    [Math.cos(angle), Math.sin(angle)])\n  return {\n    m, M,\n    t: t + T,\n    m_v: vecPlus(m_v, vecMult(T, a)),\n    m_pos: vecPlus([m_x, m_y],\n      vecPlus(vecMult(T, m_v), vecMult(square(T) / 2, a)))\n  }\n}\n\nexport const explode = (state: State, W: number): State => ({\n  ...state,\n  m_v: vecMult(Math.sqrt(1 - 2 * W / state.m / vecSquare(state.m_v)), state.m_v)\n})\n","import { clearCanvas, fadingOutTrace, Style, styledCircle } from './canvas'\nimport {\n  explode, simulate, State,\n  vecLength, vecMult, vecSquare\n} from './simulation'\n\nimport sunPhoto from './sun.png'\n\ninterface Styled {\n  style: Style\n}\n\nconst M = 1.9891e30\nconst sunRadius = 6.957e8\n\nconst data: { [key: string]: State & Styled & { name: string } } = {\n  mercury: { M, t: 0,\n    name: \"水星\",\n    style: [[0, '#7E7673'], [0.7, '#8C8384'], [1, '#B0A89D']],\n    m: 3.3011e23,\n    m_v: [0, 3.886e4],\n    m_pos: [6.982e10, 0]\n  },\n  venus: { M, t: 0,\n    name: \"金星\",\n    style: [[0, '#A96117'], [0.7, '#C08120'], [1, '#E1A83D']],\n    m: 4.8675e24,\n    m_v: [0, 3.479e4],\n    m_pos: [1.0894e11, 0]\n  },\n  earth: { M, t: 0,\n    name: \"地球\",\n    style: [[0, '#4D7ABE'], [0.7, '#5283BB'], [1, '#83B1ED']],\n    m: 5.9723e24,\n    m_v: [0, 2.929e4],\n    m_pos: [1.521e11, 0]\n  },\n  mars: { M, t: 0,\n    name: \"火星\",\n    style: [[0, '#9B5A20'], [0.7, '#AD6F2F'], [1, '#D59639']],\n    m: 6.4171e23,\n    m_v: [0, 2.197e4],\n    m_pos: [2.4923e11, 0]\n  }\n}\n\nconst multiSimulate = (state: State, T: number, steps: number): State =>\n  steps > 0\n  ? vecLength(state.m_pos) <= sunRadius\n    ? state\n    : multiSimulate(simulate(state, T), T, steps - 1)\n  : state\n\nfunction drawSun (ctx: CanvasRenderingContext2D, scale: number) {\n  const img = new Image()\n  img.addEventListener('load', () => {\n    ctx.drawImage(img,\n      ctx.canvas.width / 2 - 4e10 * scale,\n      ctx.canvas.height / 2 - 4e10 * scale,\n      8e10 * scale, 8e10 * scale)\n  })\n  img.src = sunPhoto\n}\n\nfunction drawState (\n    ctx0: CanvasRenderingContext2D, ctx1: CanvasRenderingContext2D,\n    scale: number, state: State, style: Style) {\n  const viewMPos: [number, number] = [\n    ctx0.canvas.width / 2 + state.m_pos[0] * scale,\n    ctx0.canvas.height / 2 - state.m_pos[1] * scale\n  ]\n  styledCircle(ctx0, style, viewMPos[0], viewMPos[1], 5e9 * scale)\n  fadingOutTrace(ctx1, viewMPos[0], viewMPos[1]);\n  (<HTMLSpanElement> document.getElementById('time-display')).innerText = (state.t / 3600 / 24).toFixed(3);\n  (<HTMLInputElement> document.getElementById('input-M')).valueAsNumber = state.M / 1e29;\n  (<HTMLInputElement> document.getElementById('input-m')).valueAsNumber = state.m / 1e22;\n  (<HTMLInputElement> document.getElementById('input-pos-x')).valueAsNumber = state.m_pos[0] / 1e9;\n  (<HTMLInputElement> document.getElementById('input-pos-y')).valueAsNumber = state.m_pos[1] / 1e9;\n  (<HTMLInputElement> document.getElementById('input-pos-r')).valueAsNumber = vecLength(state.m_pos) / 1e9;\n  (<HTMLInputElement> document.getElementById('input-v-x')).valueAsNumber = state.m_v[0] / 1e3;\n  (<HTMLInputElement> document.getElementById('input-v-y')).valueAsNumber = state.m_v[1] / 1e3;\n  (<HTMLInputElement> document.getElementById('input-v-len')).valueAsNumber = vecLength(state.m_v) / 1e3;\n  (<HTMLInputElement> document.getElementById('input-ek')).valueAsNumber = state.m * vecSquare(state.m_v) / 2 / 1e29\n}\n\nwindow.onload = () => {\n  const view = <HTMLDivElement> document.getElementById('view')\n\n  const canvas0 = document.createElement('canvas')\n  canvas0.height = view.clientHeight\n  canvas0.width = view.clientWidth\n  canvas0.style.zIndex = '2'\n  view.appendChild(canvas0)\n\n  const canvas1 = document.createElement('canvas')\n  canvas1.height = view.clientHeight\n  canvas1.width = view.clientWidth\n  canvas1.style.zIndex = '1'\n  view.appendChild(canvas1)\n\n  const canvas2 = document.createElement('canvas')\n  canvas2.height = view.clientHeight\n  canvas2.width = view.clientWidth\n  canvas2.style.zIndex = '0'\n  view.appendChild(canvas2)\n\n  // constants\n  const framerate = 50\n  const frameTime = 1000 / framerate\n\n  // state store\n  let viewSpeed = 3600 * 25 * 10 // 10 days / s\n  let simSpeed = framerate * 100 // 5000 steps / s\n\n  let T = viewSpeed / simSpeed\n  let steps = simSpeed / framerate\n\n  let scale = canvas0.height / 3.1e11\n  let stateStore: State = data.mercury\n  let styleStore: Style = data.mercury.style\n  let toPause = false\n  let reallyPaused = true\n\n  const ctx0 = <CanvasRenderingContext2D> canvas0.getContext('2d')\n  const ctx1 = <CanvasRenderingContext2D> canvas1.getContext('2d')\n  ctx1.fillStyle = 'white'\n  const ctx2 = <CanvasRenderingContext2D> canvas2.getContext('2d')\n\n  function redraw () {\n    clearCanvas(ctx0)\n    drawState(ctx0, ctx1, scale, stateStore, styleStore)\n  }\n\n  drawSun(ctx2, scale)\n  redraw();\n  (<HTMLInputElement> document.getElementById('input-scale')).valueAsNumber = 1 / scale / 1e7;\n  (<HTMLInputElement> document.getElementById('input-timescale')).valueAsNumber = 10\n  const inpAcc = (<HTMLInputElement> document.getElementById('input-accuracy'))\n  inpAcc.valueAsNumber = simSpeed\n  inpAcc.step = framerate.toString()\n  inpAcc.min = framerate.toString()\n  const inpCP = (<HTMLButtonElement> document.getElementById('continue-pause'));\n  (<HTMLInputElement> document.getElementById('input-work')).valueAsNumber = 0\n\n  function pause () {\n    if (! reallyPaused) {\n      toPause = true\n      inpCP.innerText = \"▶\"\n    }\n  }\n\n  function start () {\n    function frame (state: State) {\n      if (vecLength(state.m_pos) <= sunRadius) {\n        pause();\n        (<HTMLHeadingElement> document.getElementById('title')).style.color = 'red'\n      }\n      stateStore = state\n      redraw()\n      if (toPause) {\n        toPause = false\n        reallyPaused = true\n      } else setTimeout(() => frame(multiSimulate(state, T, steps)), frameTime)\n    }\n    if (reallyPaused) {\n      toPause = false\n      reallyPaused = false\n      inpCP.innerText = \"❙❙\"\n      frame(stateStore)\n    }\n  }\n\n  // time\n  inpCP.addEventListener('click', function () {\n    if (reallyPaused) start()\n    else pause()\n  });\n  (<HTMLInputElement> document.getElementById('input-timescale'))\n    .addEventListener('input', function () {\n      if (this.validity.valid) {\n        viewSpeed = 3600 * 24 * this.valueAsNumber\n        T = viewSpeed / simSpeed\n      }\n    });\n  (<HTMLInputElement> document.getElementById('input-accuracy'))\n    .addEventListener('input', function () {\n      if (this.validity.valid) {\n        simSpeed = this.valueAsNumber\n        T = viewSpeed / simSpeed\n        steps = simSpeed / framerate\n      }\n    });\n  // scale\n  (<HTMLInputElement> document.getElementById('input-scale'))\n    .addEventListener('input', function () {\n      if (this.validity.valid) {\n        scale = 1 / this.valueAsNumber / 1e7\n        clearCanvas(ctx1)\n        clearCanvas(ctx2)\n        drawSun(ctx2, scale)\n        redraw()\n      }\n    });\n  // explosion\n  (<HTMLButtonElement> document.getElementById('explode'))\n    .addEventListener('click', () => {\n      const inpWork = (<HTMLInputElement> document.getElementById('input-work'))\n      if (inpWork.validity.valid) {\n        const prevPaused = reallyPaused\n        pause()\n        setTimeout(() => {\n          stateStore = explode(stateStore, inpWork.valueAsNumber * 1e29)\n          if (! prevPaused) start()\n          else redraw()\n        }, frameTime)\n      }\n    })\n  // data\n  Object.keys(data).forEach(key => {\n    const option = document.createElement('option')\n    option.innerText = data[key].name\n    option.addEventListener('click', () => {\n      const prevPaused = reallyPaused\n      pause()\n      setTimeout(() => {\n        stateStore = data[key]\n        styleStore = data[key].style\n        clearCanvas(ctx1)\n        if (! prevPaused) start()\n        else redraw()\n      }, frameTime)\n    });\n    (<HTMLSelectElement> document.getElementById('preset-select')).add(option)\n  })\n  Array.from(\n    <HTMLCollectionOf<HTMLInputElement>>\n    (<HTMLDivElement> document.getElementById('data'))\n      .getElementsByTagName('input'))\n    .forEach(elem => {\n      elem.addEventListener('click', pause)\n      elem.addEventListener('blur', function () {\n        if (this.validity.valid) {\n          start()\n        }\n      })\n    });\n  (<HTMLInputElement> document.getElementById('input-M'))\n    .addEventListener('input', function () {\n      if (this.validity.valid) {\n        stateStore.M = this.valueAsNumber * 1e29\n        redraw()\n      }\n    });\n  (<HTMLInputElement> document.getElementById('input-m'))\n    .addEventListener('input', function () {\n      if (this.validity.valid) {\n        stateStore.m = this.valueAsNumber * 1e22\n        redraw()\n      }\n    });\n  (<HTMLInputElement> document.getElementById('input-pos-x'))\n    .addEventListener('input', function () {\n      stateStore.m_pos[0] = this.valueAsNumber * 1e9\n      redraw()\n    });\n  (<HTMLInputElement> document.getElementById('input-pos-y'))\n    .addEventListener('input', function () {\n      stateStore.m_pos[1] = this.valueAsNumber * 1e9\n      redraw()\n    });\n  (<HTMLInputElement> document.getElementById('input-pos-r'))\n    .addEventListener('input', function () {\n      stateStore.m_pos =\n        vecMult(this.valueAsNumber * 1e9 / vecLength(stateStore.m_pos),\n                stateStore.m_pos)\n      redraw()\n    });\n  (<HTMLInputElement> document.getElementById('input-v-x'))\n    .addEventListener('input', function () {\n      stateStore.m_v[0] = this.valueAsNumber * 1e3\n      redraw()\n    });\n  (<HTMLInputElement> document.getElementById('input-v-y'))\n    .addEventListener('input', function () {\n      stateStore.m_v[1] = this.valueAsNumber * 1e3\n      redraw()\n    });\n  (<HTMLInputElement> document.getElementById('input-v-len'))\n    .addEventListener('input', function () {\n      stateStore.m_v =\n        vecMult(this.valueAsNumber * 1e3 / vecLength(stateStore.m_v),\n                stateStore.m_v)\n      redraw()\n    });\n  (<HTMLInputElement> document.getElementById('input-ek'))\n    .addEventListener('input', function () {\n      stateStore.m_v = vecMult(\n        Math.sqrt(2 * this.valueAsNumber / stateStore.m)\n          / vecLength(stateStore.m_v),\n        stateStore.m_v)\n      redraw()\n    })\n}\n"]}